<!DOCTYPE html>
<html lang="{{ site.Language.LanguageCode }}" {{- if eq site.Language.LanguageDirection "rtl" }} dir="rtl" {{- end }}>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="generator" content="Hugo (Ash)"/>

        <script>
            (function(){
                try {
                    const KEY='theme';
                    const savedState=localStorage.getItem(KEY);
                    const theme=savedState ? savedState : (
                        (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)
                            ? 'dark'
                            : 'light'
                    );
                    document.documentElement.setAttribute('data-theme',theme);
                } catch(e) {

                }})();
        </script>
        <meta name="color-scheme" content="light dark"/>
        <link rel="stylesheet" type="text/css" href="{{ absURL `css/style.css` }}"/>
        {{- with site.Params.fontAwesomeURL }}
        <link rel="stylesheet" href="{{ . }}"/>
        {{- end -}}

        {{- if .Params.canonicalUrl -}}
        <link rel="canonical" href="{{ .Params.canonicalUrl }}">
        {{ else }}
        <link rel="canonical" href="{{ .Permalink }}">
        {{ end }}

        {{- with .Params.author | compare.Default .Site.Params.author }}
          {{- $author := . -}}
          {{- if reflect.IsSlice . -}}
            {{- $author = collections.Delimit . ", " | transform.Plainify -}}
          {{- end -}}
        <meta name="author" content="{{ $author }}">
        {{- end }}
        <title>{{ block "title" . }}{{ with .Params.Title }}{{ . }} | {{ end }}{{ .Site.Title }}{{ end }}</title>

        {{- if .Site.Params.favicon }}
        <link rel="shortcut icon" href="{{ urls.RelURL ($.Site.Params.favicon) }}" type="image/x-icon" />
        {{ end }}
        {{ if .OutputFormats.Get "RSS" }}
        {{- with .OutputFormats.Get "RSS" }}
        <link href="{{ .RelPermalink }}" rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" />
        <link href="{{ .RelPermalink }}" rel="feed" type="application/rss+xml" title="{{ $.Site.Title }}" />
          {{- end }}
        {{- end }}
    </head>
    <body>
        {{ block "header" . }}{{ partials.IncludeCached "header.html" . }}{{ end }}
        <div id="wrapper">
            <div id="main-container">
                <div id="content">
                    <main>
                        {{ block "main" . }}{{ end }}
                    </main>
                </div>
                {{/* Sidebar (enabled by default; can be disabled via params) */}}
                {{ $enabled := true }}
                {{ with site.Params.sidebar }}
                  {{ $enabled = .enable | default true }}
                {{ end }}
                {{ if $enabled }}
                  {{ partial "sidebar.html" . }}
                {{ end }}
            </div>
        </div>
        {{ block "footer" . }}{{ partials.IncludeCached "footer.html" . }}{{ end }}
        <script>
        (function() {
            const KEY='theme';
            const doc = document.documentElement;
            const btn = document.getElementById('theme-toggle');
            function setTheme(theme, persist) {
                doc.setAttribute('data-theme', theme);
                if (btn) {
                    btn.setAttribute('aria-pressed', String( theme ==='dark'));
                    btn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    btn.title = 'Toggle theme(current: ' + (theme === 'dark' ? 'dark' : 'light') + ')';
                }
                if (persist) {
                try {
                    localStorage.setItem(KEY, theme);
                } catch(e) {

                }
                }
            }

            function getStored() {
                try {
                    return localStorage.getItem(KEY) || null;
                } catch (e) {
                    return null;
                }
            }

            const mediaQuery = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');

            function systemTheme() {
                return (mediaQuery && mediaQuery.matches) ? 'dark' : 'light';
            }

            if (btn) {
                btn.addEventListener('click', function () {
                    const current = doc.getAttribute('data-theme') || systemTheme();
                    const next = current === 'dark' ? 'light' : 'dark';
                    setTheme(next, true);
                });
            }
            if (mediaQuery && mediaQuery.addEventListener) {
                mediaQuery.addEventListener('change', function () {
                    if (!getStored()) {
                        setTheme(systemTheme(), false);
                    }
                });
            } else if (mediaQuery && mediaQuery.addListener) {
                mediaQuery.addListener(function () {
                    if (!getStored()) {
                        setTheme(systemTheme(), false);
                    }
                });
            }
            setTheme(doc.getAttribute('data-theme') || systemTheme(), false);
        })();
        </script>
    </body>
</html>